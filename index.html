<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Splash & Dash</title>
<style>
html,body{margin:0;padding:0;background:#111;font-family:monospace;touch-action:none}
canvas{display:block;margin:auto;background:#cfd8dc}
button{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:40px;padding:14px 26px;
  font-size:16px;font-weight:bold;
  background:#4fc3f7;border:none;border-radius:10px
}
#ui{
  position:fixed;top:6px;left:0;width:100%;
  color:#fff;font-size:14px;
  display:flex;justify-content:space-between;padding:0 10px
}
</style>
</head>
<body>

<div id="ui" style="display:none">
  <div>Score: <span id="score">0</span></div>
  <div>Combo: <span id="combo">x1</span></div>
</div>

<button id="startBtn">START</button>

<canvas id="game" width="360" height="640"></canvas>

<script>
const c = document.getElementById("game");
const x = c.getContext("2d");
const ui = document.getElementById("ui");
const startBtn = document.getElementById("startBtn");

let state = "menu";
let score = 0, combo = 1, difficulty = 1;

const girl = {x:180,y:520};
const man = {x:180,y:200,dir:1,alert:0,turnTimer:120};

let tx = girl.x, ty = girl.y;

// TOUCH
c.ontouchstart = c.ontouchmove = e=>{
  tx = e.touches[0].clientX*c.width/innerWidth;
  ty = e.touches[0].clientY*c.height/innerHeight;
};

// START
startBtn.onclick = ()=>{
  state="play";
  score=0;combo=1;difficulty=1;
  ui.style.display="flex";
  startBtn.style.display="none";
};

// SPLASH
c.addEventListener("click",splash);
function splash(){
  if(state!=="play")return;
  const dx=Math.abs(girl.x-man.x);
  const dy=girl.y-man.y;
  if(dx<30 && dy>0 && dy<90 && man.alert===0){
    score+=100*combo;
    combo++;
    man.alert=20;
  }else{
    gameOver();
  }
}

function gameOver(){
  state="over";
  ui.style.display="none";
  startBtn.innerText="RETRY";
  startBtn.style.display="block";
}

// UPDATE
function update(){
  if(state!=="play")return;

  girl.x+=(tx-girl.x)*0.12;
  girl.y+=(ty-girl.y)*0.12;

  difficulty = 1 + Math.floor(score/500);

  man.x+=man.dir*(1.2+difficulty*0.3);
  if(man.x>280||man.x<80)man.dir*=-1;

  man.turnTimer--;
  if(man.turnTimer<=0){
    man.alert=15;
    man.turnTimer=80-Math.min(50,difficulty*8);
  }

  if(man.alert>0){
    man.alert--;
    if(Math.abs(girl.x-man.x)<40 && girl.y>man.y){
      gameOver();
    }
  }

  document.getElementById("score").innerText=score;
  document.getElementById("combo").innerText="x"+combo;
}

// DRAW
function draw(){
  x.clearRect(0,0,360,640);
  x.fillStyle="#b0bec5";
  x.fillRect(0,0,360,640);

  if(state==="menu"){
    x.fillStyle="#000";
    x.font="20px monospace";
    x.fillText("SPLASH & DASH",70,280);
    x.font="14px monospace";
    x.fillText("Tap START to play",100,320);
    return;
  }

  // vision
  x.fillStyle="rgba(255,0,0,0.15)";
  x.fillRect(man.x-45,man.y,90,130);

  // man
  x.fillStyle="#455a64";
  x.fillRect(man.x-6,man.y-6,12,12);

  // girl
  x.fillStyle="#ff8a80";
  x.fillRect(girl.x-6,girl.y-6,12,12);

  if(state==="over"){
    x.fillStyle="#000";
    x.font="20px monospace";
    x.fillText("GAME OVER",110,280);
    x.font="14px monospace";
    x.fillText("Score: "+score,130,310);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
