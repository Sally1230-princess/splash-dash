<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Office Prank: Pixel Art Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
    body { margin: 0; background: #222; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
    canvas { background: #d1d5db; image-rendering: pixelated; touch-action: manipulation; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const W = 160;
const H = 240;
const SCALE = Math.min(window.innerWidth / W, window.innerHeight / H) * 0.95;
canvas.width = W * SCALE;
canvas.height = H * SCALE;
ctx.scale(SCALE, SCALE);

/* --- GAME STATE --- */
let score = 0, water = 100, gameOver = false, tick = 0;
const player = { x: 70, y: 180, dir: 1, splashing: false };
const victim = { x: 70, y: 60, state: 'walk', timer: 100, dir: 1 };
const dispenser = { x: 130, y: 150 }; // Cây nước để refill

/* --- DRAWING FUNCTIONS (Pixel Art Style) --- */

function drawGirl(x, y, scale=1) {
    ctx.save();
    ctx.translate(x, y);
    
    // Tóc bím nâu (Brown Hair)
    ctx.fillStyle = "#5a3a22";
    ctx.fillRect(2, -4, 12, 10); // Đầu tóc
    ctx.fillRect(0, 0, 4, 12);   // Bím trái
    ctx.fillRect(12, 0, 4, 12);  // Bím phải
    
    // Nơ hồng (Pink Bows)
    ctx.fillStyle = "#ff99aa";
    ctx.fillRect(-1, -1, 3, 3); 
    ctx.fillRect(14, -1, 3, 3);
    
    // Mặt (Face)
    ctx.fillStyle = "#ffe0bd";
    ctx.fillRect(4, 1, 8, 8);
    // Mắt
    ctx.fillStyle = "#331a00";
    ctx.fillRect(6, 4, 1.5, 2); ctx.fillRect(9, 4, 1.5, 2);

    // Váy hồng chấm bi (Pink Polka-dot Dress)
    ctx.fillStyle = "#ff6688";
    ctx.fillRect(2, 9, 12, 12);
    ctx.fillStyle = "#fff"; // Chấm bi
    ctx.fillRect(4, 11, 1, 1); ctx.fillRect(10, 15, 1, 1); ctx.fillRect(6, 18, 1, 1);

    // Xô nước xanh (Blue Bucket)
    ctx.fillStyle = "#0077be";
    if(player.splashing) {
        ctx.fillRect(-6, 8, 10, 6);
        ctx.fillStyle = "#87ceeb";
        ctx.fillRect(-12, 4, 8, 3); // Tia nước
    } else {
        ctx.fillRect(12, 12, 7, 7);
    }
    
    ctx.restore();
}

function drawDispenser() {
    // Thùng nước (Blue Bottle)
    ctx.fillStyle = "#63b3ed";
    ctx.fillRect(dispenser.x + 2, dispenser.y - 12, 10, 12);
    // Thân máy (White base)
    ctx.fillStyle = "#f8fafc";
    ctx.fillRect(dispenser.x, dispenser.y, 14, 20);
    // Vòi nước đỏ/xanh
    ctx.fillStyle = "red"; ctx.fillRect(dispenser.x+3, dispenser.y+5, 2, 2);
    ctx.fillStyle = "blue"; ctx.fillRect(dispenser.x+9, dispenser.y+5, 2, 2);
}

function drawBackground() {
    // Sàn và Tường
    ctx.fillStyle = "#e2e8f0"; ctx.fillRect(0, 0, W, 160); // Tường
    ctx.fillStyle = "#cbd5e0"; ctx.fillRect(0, 160, W, 80); // Sàn
    
    // Biển báo Exit (Giống ảnh)
    ctx.fillStyle = "#047857"; ctx.fillRect(10, 10, 25, 12);
    ctx.fillStyle = "white"; ctx.font = "bold 6px Arial"; ctx.fillText("← EXIT", 12, 19);

    // Camera an ninh
    ctx.fillStyle = "#475569";
    ctx.fillRect(W-25, 5, 15, 8);
    ctx.beginPath();
    ctx.arc(W-25, 12, 3, 0, Math.PI*2);
    ctx.fill();
}

/* --- LOGIC --- */

function update() {
    if(gameOver) return;
    tick++;

    // Điều khiển
    if (keys['ArrowLeft'] && player.x > 5) player.x -= 1.2;
    if (keys['ArrowRight'] && player.x < W-20) player.x += 1.2;

    // Refill nước
    if(player.x > dispenser.x - 15 && water < 100) {
        water += 1;
        if(tick % 10 === 0) playTone(800, 0.05);
    }

    // Victim AI
    victim.timer--;
    if(victim.timer <= 0) {
        if(victim.state === 'walk') { victim.state = 'alert'; victim.timer = 40; }
        else if(victim.state === 'alert') { victim.state = 'look'; victim.timer = 50; }
        else { victim.state = 'walk'; victim.timer = 100 + Math.random()*50; }
    }
    
    if(victim.state === 'walk') {
        victim.x += victim.dir * 0.5;
        if(victim.x < 20 || victim.x > W-30) victim.dir *= -1;
    }

    // Kiểm tra thua cuộc
    const dist = Math.sqrt((player.x - victim.x)**2 + (player.y - victim.y)**2);
    if(victim.state === 'look' && dist < 70) {
        gameOver = true;
    }
}

function splash() {
    if(water <= 0 || player.splashing || gameOver) return;
    player.splashing = true;
    water -= 25;
    
    const dist = Math.sqrt((player.x - victim.x)**2 + (player.y - victim.y)**2);
    if(dist < 45 && victim.state !== 'look') {
        score += 50;
        playTone(400, 0.2);
    }
    setTimeout(() => player.splashing = false, 300);
}

/* --- UTILS --- */
const keys = {};
window.onkeydown = e => { keys[e.code] = true; if(e.code==='Space') splash(); if(gameOver) location.reload(); };
window.onkeyup = e => keys[e.code] = false;
function playTone(f, d) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.frequency.value = f; g.gain.value = 0.1;
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function draw() {
    drawBackground();
    drawDispenser();
    
    // Draw Victim
    ctx.fillStyle = "#2d3748"; ctx.fillRect(victim.x, victim.y+10, 16, 20); // Vest
    ctx.fillStyle = "#ffe0bd"; ctx.fillRect(victim.x+3, victim.y, 10, 10); // Face
    if(victim.state === 'look') {
        ctx.fillStyle = "red"; ctx.fillRect(victim.x+5, victim.y+4, 2, 2); ctx.fillRect(victim.x+9, victim.y+4, 2, 2);
    }

    drawGirl(player.x, player.y);

    // UI
    ctx.fillStyle = "#1e293b"; ctx.font = "8px Arial";
    ctx.fillText("SCORE: " + score, 10, 35);
    ctx.fillStyle = "#3498db";
    ctx.fillRect(10, 40, water/2, 4); // Thanh nước
    
    if(gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0,W,H);
        ctx.fillStyle = "white"; ctx.fillText("BỊ BẮT RỒI!", 55, 110);
        ctx.font = "6px Arial"; ctx.fillText("Bấm để chơi lại", 58, 125);
    }
    
    requestAnimationFrame(draw);
}

draw();
update();
setInterval(update, 1000/60);
</script>
</body>
</html>
